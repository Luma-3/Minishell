/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   test.c                                             :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: jbrousse <jbrousse@student.42.fr>          +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2024/03/25 16:52:35 by jbrousse          #+#    #+#             */
/*   Updated: 2024/03/25 17:17:37 by jbrousse         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <fcntl.h>
#include <utmp.h>
#include <termios.h>
#include <sys/ioctl.h>

int	main(void)
{
	int fd;
	struct utmp user;

	fd = open("/var/run/utmp", O_RDONLY);
	if (fd == -1)
	{
		perror("open");
		exit(EXIT_FAILURE);
	}
	while (read(fd, &user, sizeof(struct utmp)) > 0)
	{
		// char *ut_line = malloc(UT_LINESIZE + 1);
		// strncpy(ut_line, user.ut_line, UT_LINESIZE);
		// printf("Line: %s\n", (user.ut_line));
		// printf("Terminal: %s\n", ttyname(STDIN_FILENO) + 5);
		if (user.ut_type == USER_PROCESS && strncmp((char *)(user.ut_line), ttyname(STDIN_FILENO) + 5, UT_LINESIZE - 5) == 0)
			printf("User: %s\n", user.ut_name);
	}
	close(fd);
}

// int main() {
//     int fd = STDIN_FILENO; // Utilise l'entrée standard (le terminal)
    
//     if (isatty(fd)) { // Vérifie si fd est un terminal
//         char *tty_name = ttyname(fd); // Obtient le nom du terminal
//         if (tty_name != NULL) {
//             printf("Terminal name: %s\n", tty_name);
            
//             struct winsize ws;
//             if (ioctl(fd, TIOCGWINSZ, &ws) == 0) {
//                 printf("Terminal width: %d\n", ws.ws_col);
//                 printf("Terminal height: %d\n", ws.ws_row);
//             }
            
//             struct termios term;
//             if (tcgetattr(fd, &term) == 0) {
//                 // Vous pouvez inspecter les attributs du terminal ici
//             }
//         } else {
//             perror("Error getting terminal name");
//             return EXIT_FAILURE;
//         }
//     } else {
//         printf("Not a terminal.\n");
//         return EXIT_FAILURE;
//     }
    
//     return EXIT_SUCCESS;
// }
